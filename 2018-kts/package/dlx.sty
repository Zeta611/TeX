
\ProvidesPackage{dlx}[2018/02/03 v0.1 Dancing links]

\RequirePackage{luatexbase}
\@ifpackageloaded{xcolor}{}{\RequirePackage[svgnames]{xcolor}}
\RequirePackage{sudoku}
\RequirePackage{chessboard}


%% pentomino

\directlua{require "pentomino"}

\fboxsep=0pt
\def\fr@me{\rule{\@side}{\@side}}
\def\cell@O{\fbox{\color{Maroon}\fr@me}}
\def\cell@P{\fbox{\color{DarkOrange}\fr@me}}
\def\cell@Q{\fbox{\color{Chocolate}\fr@me}}
\def\cell@R{\fbox{\color{LightSteelBlue}\fr@me}}
\def\cell@S{\fbox{\color{yellow}\fr@me}}
\def\cell@T{\fbox{\color{red}\fr@me}}
\def\cell@U{\fbox{\color{DarkViolet}\fr@me}}
\def\cell@V{\fbox{\color{CornflowerBlue}\fr@me}}
\def\cell@W{\fbox{\color{Green}\fr@me}}
\def\cell@X{\fbox{\color{DeepPink}\fr@me}}
\def\cell@Y{\fbox{\color{green}\fr@me}}
\def\cell@Z{\fbox{\color{DarkKhaki}\fr@me}}
\def\cell@B{\fbox{\color{white}\fr@me}}

\newcommand\Row[1]{%
  \par\nobreak\nointerlineskip\vskip-\fboxrule%
  \@tfor\@tempa:=#1 \do {\csname cell@\@tempa\endcsname\kern-\fboxrule}}

\newenvironment{Pentomino}[1][]
  {\bgroup \parindent0pt \parskip0pt
    \newcommand\@side{#1}}
  {\egroup\par}

\protected\def\pentomino#1#2#3#4.{%
  \def\@n{#4}
  \ifx\empty\@n \def\@n{10000}\fi
  \directlua{pentomino.draw("#1",#2,#3,\@n)}}


%% sudoku

\directlua{require "sudoku"}

\def\sudoku@#1{%
  \directlua{sudokudlx.solve(
    \ifx\answ@r Ytrue\else flase\fi, "#1")}
  \egroup}

\protected\def\Sudoku#1#{%
  \bgroup\parindent=0pt
  \renewcommand*\sudokuformat[1]{\Large\bfseries\ttfamily##1}%
  \setlength\sudokusize{6cm}%
  \ifx\empty#1\empty
    \let\answ@r N%
  \else
    \let\answ@r Y%
  \fi
  \sudoku@}


%% queens

\directlua{require "queens"}

\protected\def\queens#1#2.{%
  \def\@n{#2}
  \ifx\empty\@n \def\@n{10000}\fi
  \begingroup
  \parindent0pt
  \directlua{queens.chessboard(#1,\@n)}
  \endgroup
}

